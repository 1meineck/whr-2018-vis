<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" type="text/css" href="stylesheet.css">

<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js" charset- "utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.3.0/d3-legend.js" charset="utf-8"></script>

    <title> World Happiness Report 2018</title>
    <h1> World Happiness Report 2018</h1>
</head>


<body>

    <div class="wrap" id="main">
        <div class="wrap" id="upper">
            <div id="body">
                <div class="w3-display-container" id="chart">
                    <button id="invert_button" class="w3-button w3-teal w3-display-topleft" onclick="selectFilter()">MAX</button>
                </div>
                <div class="update-value"></div>
            </div>
            <div class="plot" id="choropleth"></div>
            <div class="w3-display-container" id="radar">
                <button class="w3-button w3-circle w3-teal w3-display-bottomleft" onclick="addOnClick()">+</button>
            </div>
        </div>
        <div id="lower">
            <div class="radarset" id="overviewChart"></div>
            <div class="w3-display-container radarset" id="radar1">
                <button class="w3-button w3-circle w3-teal w3-display-bottomleft" onclick="removeData(radarChart1)">&#8249;</button>
            </div>
            <div class="w3-display-container radarset" id="radar2">
                <button class="w3-button w3-circle w3-teal w3-display-bottomleft" onclick="removeData(radarChart2)">&#8249;</button>
            </div>
            <div class="w3-display-container radarset" id="radar3">
                <button class="w3-button w3-circle w3-teal w3-display-bottomleft" onclick="removeData(radarChart3)">&#8249;</button>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="data.js"></script>

    <script type="text/javascript" src="script.js"></script>
    <script src="whr_data_vis.js"></script>
    <script type="text/javascript" src="data2.js"></script>
    <script src="choropleth.js"></script>
    <script src="radarChart.js"></script>

    <script>
        var operation = d3.select('body').append('div').append('h2');

        data = [];
        radarCharts_single = [];

        var color = d3.scale.ordinal()
            .range(['#1f78b4', '#b2df8a', '#33a02c', '#a6cee3', '#fb9a99']);

        array0 = {
            "Country": "No Country Selected",
            "HappinessScore": 0.0,
            "Dystopia": 0.0,
            "GDP": 0.0,
            "SocialSupport": 0.0,
            "LifeExpectancy": 0.0,
            "LifeChoices": 0.0,
            "Generosity": 0.0,
            "Corruption": 0.0
        }
        //TODO: Change Chart Options
        //Chart Options
        var radarChartOptions = {
            width: 400,
            height: 400,
            color: color
        };

        var radarChartOptions_lower = {
            width: 400,
            height: 400,
            color: color
        };

        // upper Chart - Quick View

        radarChart = RadarChart();
        //this should happen for setup for each chart
        radarChart.options({ 'legend': { display: true } });
        radarChart.options({ 'legend': { symbol: 'triangle-down' } })
        //set stacking to true if multiple areas should be drawn
        radarChart.stacking(false).update()
        radarChart.addData(array0)
        d3.select('#radar')
            .call(radarChart);
        radarChart.options(radarChartOptions).update();

        // lower Charts - Overview & Compare
        overviewChart = RadarChart();
        //this should happen for setup for each chart
        overviewChart.options({ 'legend': { display: true } });
        overviewChart.options({ 'legend': { symbol: 'triangle-down' } })
        //set stacking to true if multiple areas should be drawn
        overviewChart.stacking(true).update()
        overviewChart.addData(array0)

        d3.select('#overviewChart')
            .call(overviewChart);

        overviewChart.options(radarChartOptions_lower).update();


        radarChart1 = RadarChart();
        //this should happen for setup for each chart
        radarChart1.options({ 'legend': { display: true } });
        radarChart1.options({ 'legend': { symbol: 'triangle-down' } })
        //set stacking to true if multiple areas should be drawn
        radarChart1.stacking(false).update()
        radarChart1.addData(array0)
        d3.select('#radar1')
            .call(radarChart1);
        radarChart1.options(radarChartOptions_lower).update();
        radarCharts_single.push(radarChart1)

        radarChart2 = RadarChart();
        //this should happen for setup for each chart
        radarChart2.options({ 'legend': { display: true } });
        radarChart2.options({ 'legend': { symbol: 'triangle-down' } })
        //set stacking to true if multiple areas should be drawn
        radarChart2.stacking(false).update()
        radarChart2.addData(array0)
        d3.select('#radar2')
            .call(radarChart2);
        radarChart2.options(radarChartOptions_lower).update();
        radarCharts_single.push(radarChart2)

        radarChart3 = RadarChart();
        //this should happen for setup for each chart
        radarChart3.options({ 'legend': { display: true } });
        radarChart3.options({ 'legend': { symbol: 'triangle-down' } })
        //set stacking to true if multiple areas should be drawn
        radarChart3.stacking(false).update()
        radarChart3.addData(array0)
        d3.select('#radar3')
            .call(radarChart3);
        radarChart3.options(radarChartOptions_lower).update();
        radarCharts_single.push(radarChart3)

    </script>
    <script>
        //TODO: choose colors for radar_chart min and max, change initial color of radarchart accordingly
        //maybe change button-color?
        color_min = '#ff0000'
        color_max = '#00ffff'

        function addOnClick() {
            added = false
            //check if there is data to add
            if (radarChart.is_empty()){
                return
            }
            var name = radarChart.get_content()
            //check if the country is already in the dataset
            for(var i=0; i < radarCharts_single.length; i++){
                chart = radarCharts_single[i]
                if(chart.get_content() == name){
                    console.log(name)
                    return
                }
            }
            //TODO: check if radar 1, 2, 3 is empty -> add data
            for (var i = 0; i < radarCharts_single.length; i++) {  
                if(radarCharts_single[i].is_empty() && !added){
                    radarCharts_single[i].addData(happy)
                    overviewChart.addData(happy)
                    added = true
                }
            }
        
            if (added){
                overviewChart.addData(happy);
            }
            else{
                alert("Please remove one of the exisiting datasets")
            }
        }

        function selectFilter() {
            //TODO: change color of filter - DONE
            invertbutton = document.getElementById("invert_button")
            if (selection){
                setColor(color_min)
                invertbutton.innerText="MIN"
            }
            else{
                setColor(color_max)
                invertbutton.innerText="MAX"
            }
            selection = !selection;
            set_data_to_selection();
            update_choropleth();
            //update_all();
        }

        function addToOverview(){
            //TODO: get happy_data from respective radarChart, might need a different function for each radar
            happy_data = happy;
            overviewChart.addData(happy_data);
        }

        function removeData(chart){
            var country_name
            country_name = chart.get_content()
            chart.removeData(country_name)
            overviewChart.removeData(country_name)
        }

        function update_all() {
            select_data();
            update_choropleth();
        }
    </script>


</body>

</html>